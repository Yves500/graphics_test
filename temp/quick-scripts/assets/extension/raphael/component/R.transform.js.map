{"version":3,"sources":["R.transform.js"],"names":["Transform","properties","_scale","default","cc","v2","_position","_rotation","_flipX","_flipY","_transform","a","b","c","d","tx","ty","serializable","_worldTransform","_transformDirty","notify","parent","_dirty","scale","get","set","value","equals","position","rotation","flipX","flipY","_transformCommand","cmd","t","length","slice","tempPoint","i","ii","j","x","y","AffineTransform","transformVec2","getTransform","scaleX","scaleY","positionX","positionY","rotationRadians","Math","sin","cos","sx","sy","getWorldTransform","concat","updateTransform","parentTransformDirty","children","child","module","exports"],"mappings":"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","file":"R.transform.js","sourceRoot":"../../../../../../assets/extension/raphael/component","sourcesContent":["\nvar Transform = {\n\n    properties: {\n        _scale: {\n            default: cc.v2(1, 1),\n        },\n        _position: {\n            default: cc.v2(0,0),\n        },\n        _rotation: 0,\n        \n        _flipX: false,\n        _flipY: false,\n\n        _transform: {\n            default: function () {\n                return {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n            },\n            serializable: false\n        },\n\n        _worldTransform: {\n            default: function () {\n                return {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n            },\n            serializable: false\n        },\n\n        _transformDirty: {\n            default: true,\n            serializable: false,\n\n            notify: function () {\n                if (this._transformDirty) {\n                    if (this.parent) {\n                        this.parent._transformDirty = true;\n                    }\n\n                    this._dirty = true;\n                }\n            }\n        },\n\n        scale: {\n            get: function () {\n                return this._scale;\n            },\n            set: function (value) {\n                if (this._scale.equals(value)) {\n                    return;\n                }\n                this._scale = value;\n                this._transformDirty = true;\n            }\n        },\n\n        position: {\n            get: function () {\n                return this._position;\n            },\n            set: function (value) {\n                if (this._position.equals(value)) {\n                    return;\n                }\n                this._position = value;\n                this._transformDirty = true;\n            }\n        },\n\n        rotation: {\n            get: function () {\n                return this._rotation;\n            },\n            set: function (value) {\n                if (this._rotation === value) {\n                    return;\n                }\n                this._rotation = value;\n                this._transformDirty = true;\n            }\n        },\n\n\n        flipX: {\n            get: function () {\n                return this._flipX;\n            },\n            set: function (value) {\n                if (this._flipX === value) {\n                    return;\n                }\n                this._flipX = value;\n                this._transformDirty = true;\n            }\n        },\n\n        flipY: {\n            get: function () {\n                return this._flipY;\n            },\n            set: function (value) {\n                if (this._flipY === value) {\n                    return;\n                }\n                this._flipY = value;\n                this._transformDirty = true;\n            }\n        },\n    },\n\n    _transformCommand: function (cmd, t) {\n        if (cmd.length <= 1) {\n            return cmd;\n        }\n        \n        cmd = cmd.slice(1, cmd.length);\n\n        if (t.a === 1 && t.d === 1 &&\n            t.b === 0 && t.c === 0 &&\n            t.tx === 0 && t.ty === 0) {\n            return cmd;\n        }\n\n        var tempPoint = cc.v2();\n\n        for (var i = 0, ii = cmd.length / 2; i < ii; i++) {\n            var j = i*2;\n            tempPoint.x = cmd[j];\n            tempPoint.y = cmd[j + 1];\n\n            tempPoint = cc.AffineTransform.transformVec2([], tempPoint, t);\n\n            cmd[j] = -tempPoint.x;\n            cmd[j+1] = tempPoint.y;\n        }\n\n        return cmd;\n    },\n\n    getTransform: function () {\n        if (this._transformDirty) {\n            var scaleX = this.flipX ? -this._scale.x : this._scale.x;\n            var scaleY = this.flipY ? -this._scale.y : this._scale.y;\n            var positionX = this._position.x;\n            var positionY = this._position.y;\n            var rotation = this._rotation;\n\n            var t = this._transform;\n            t.tx = positionX;\n            t.ty = positionY;\n            t.a = t.d = 1;\n            t.b = t.c = 0;\n\n            // rotation Cos and Sin\n            if (rotation) {\n                var rotationRadians = rotation * 0.017453292519943295;  //0.017453292519943295 = (Math.PI / 180);   for performance\n                t.c = Math.sin(rotationRadians);\n                t.d = Math.cos(rotationRadians);\n                t.a = t.d;\n                t.b = -t.c;\n            }\n\n            // Firefox on Vista and XP crashes\n            // GPU thread in case of scale(0.0, 0.0)\n            var sx = (scaleX < 0.000001 && scaleX > -0.000001) ? 0.000001 : scaleX,\n                sy = (scaleY < 0.000001 && scaleY > -0.000001) ? 0.000001 : scaleY;\n\n            // scale\n            if (scaleX !== 1 || scaleY !== 1) {\n                t.a *= sx;\n                t.b *= sx;\n                t.c *= sy;\n                t.d *= sy;\n            }\n\n            this._transformDirty = false;\n        }\n\n        return this._transform;\n    },\n\n    getWorldTransform: function () {\n        if (this.parent) {\n            return cc.AffineTransform.concat([],this.parent.getWorldTransform(), this.getTransform());\n        }\n\n        return this.getTransform();\n    },\n\n    updateTransform: function (parentTransformDirty) {\n        if (this._transformDirty || parentTransformDirty) {\n            var scaleX = this.flipX ? -this._scale.x : this._scale.x;\n            var scaleY = this.flipY ? -this._scale.y : this._scale.y;\n            var positionX = this._position.x;\n            var positionY = this._position.y;\n            var rotation = this._rotation;\n\n            var t = this._transform;\n            t.tx = positionX;\n            t.ty = positionY;\n            t.a = t.d = 1;\n            t.b = t.c = 0;\n\n            // rotation Cos and Sin\n            if (rotation) {\n                var rotationRadians = rotation * 0.017453292519943295;  //0.017453292519943295 = (Math.PI / 180);   for performance\n                t.c = Math.sin(rotationRadians);\n                t.d = Math.cos(rotationRadians);\n                t.a = t.d;\n                t.b = -t.c;\n            }\n\n            // Firefox on Vista and XP crashes\n            // GPU thread in case of scale(0.0, 0.0)\n            var sx = (scaleX < 0.000001 && scaleX > -0.000001) ? 0.000001 : scaleX,\n                sy = (scaleY < 0.000001 && scaleY > -0.000001) ? 0.000001 : scaleY;\n\n            // scale\n            if (scaleX !== 1 || scaleY !== 1) {\n                t.a *= sx;\n                t.b *= sx;\n                t.c *= sy;\n                t.d *= sy;\n            }\n        }\n\n        if (this.parent) {\n            this._worldTransform = cc.AffineTransform.concat([],this.parent._worldTransform, this._transform);\n        }\n        else {\n            this._worldTransform = this._transform;\n        }\n\n        var children = this.children;\n        if (children) {\n            for (var i = 0, ii = children.length; i < ii; i++) {\n                var child = children[i];\n                child.updateTransform(parentTransformDirty || this._transformDirty);\n            }\n        }        \n\n        this._transformDirty = false;\n    }\n};\n\nmodule.exports = Transform;\n"]}